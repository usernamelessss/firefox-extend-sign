!function(){"use strict";let e;const t=()=>{e=document.createElement("div"),e.classList.add("toast-container"),document.body.appendChild(e),e.addEventListener("toastMsg",(function(e){n(e.detail.message)}))},n=(n,o)=>{"object"==typeof n&&(n=JSON.stringify(n,null,2)),e||t();const s=document.createElement("div");s.classList.add("toast","hide"),s.textContent=n,e.append(s),s.classList.toggle("hide"),s.classList.toggle("slideInDown"),setTimeout((()=>{s.classList.toggle("hide"),s.classList.toggle("slideInDown"),setTimeout((()=>{s.remove()}),350)}),3e3)};const o=()=>{document.addEventListener("collect-files",(()=>{const e=(()=>{const e=document.querySelector(".ant-spin-container > .hombody");if(!e)return[];const t=Object.values(e)[0];return(e=>{let t=[];for(let n=0;n<e.length;n++){const o=e[n];if(o?.Etag&&o?.checked){const{FileId:e,FileName:n,Etag:s,Type:a,Size:i,S3KeyFlag:d}=o;t.push({FileId:e,FileName:n,Etag:s,Type:a,Size:i,S3KeyFlag:d})}}return t})(t?.child?.pendingProps?.props?.children?.props?.dataSource||t?.child?.pendingProps?.props?.children?.props?.loadedFileList||[])})().map((e=>[e.Etag,e.Size,e.FileName]));e.length>50?n("最多导出50个文件"):0!==e.length?function(e,t="data.json"){const n=JSON.stringify(e,null,2),o=new Blob([n],{type:"application/json"}),s=URL.createObjectURL(o),a=document.createElement("a");a.href=s,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}(e):n("未勾选任何文件")}))},s={platform:"android","app-version":"75","content-type":"application/json",Accept:"*/*",Connection:"keep-alive"},a=()=>{const{search:e}=location;return""===e?0:e.startsWith("?homeFilePath=")?"?homeFilePath="===e?0:e.includes(",")?e.split(",").at(-1):e.split("=").at(-1):void 0},i=async({md5:e,size:t,fileName:n})=>{const o={method:"POST",headers:{...s,authorization:`Bearer ${localStorage.getItem("authorToken")}`},body:JSON.stringify({driveId:0,duplicate:1,NotReuse:!0,etag:e.toLowerCase(),fileName:n,parentFileId:Number(a()),size:t,type:0})},i=await(await fetch("https://www.123pan.com/api/file/upload_request",o)).json(),{Reuse:d}=i.data,{FileName:l}=i.data.Info;return{Reuse:d,FileName:l}},d=()=>{const e=document.createElement("button");e.id="importJson",e.textContent="导入到当前文件夹",document.body.appendChild(e),e.addEventListener("click",(function(){let e=document.getElementById("json-drop-overlay");if(e)return void(e.style.display="flex");e=document.createElement("div"),e.id="json-drop-overlay";const t=document.createElement("div");t.classList.add("drop-box-visual"),t.textContent="将 JSON 文件拖放到此窗口任意位置";const o=document.createElement("button");o.textContent="X",o.classList.add("close-button"),o.onclick=()=>{e.style.display="none"},e.appendChild(o),e.appendChild(t),document.body.appendChild(e),e.addEventListener("dragover",(e=>{e.preventDefault(),e.stopPropagation(),t.style.borderColor="#0f0"})),e.addEventListener("dragleave",(e=>{e.stopPropagation(),t.style.borderColor="#00f"})),e.addEventListener("drop",(o=>{o.preventDefault(),o.stopPropagation(),t.style.borderColor="#00f";const s=o.dataTransfer.files;if(0===s.length)return void n("没有拖放任何文件。");const a=s[0];if("application/json"!==a.type&&!a.name.toLowerCase().endsWith(".json"))return void n("拖放的文件不是 JSON 文件。请拖放 .json 文件。");a.name,a.type,a.size;const d=new FileReader;d.onload=t=>{try{const o=t.target.result,s=JSON.parse(o.toString());let a=[];if(Array.isArray(s))a=s;else{if(!("usesBase62EtagsInExport"in s))return e.style.display="none",void n("导入的json格式不受支持");if(!0===s.usesBase62EtagsInExport)return e.style.display="none",void n("导入的json 使用了 usesBase62EtagsInExport, 请导出的时候关闭此项");if(!s?.files)return e.style.display="none",void n("导入的json不含任何文件");let t=!1;for(const{path:e,size:n,etag:o}of s.files){const s=e.match(/[^/\\]+$/),i=s?s[0]:"";if(!s||!s?.[0]){t=!0;break}a.push([o,n,i])}if(t)return e.style.display="none",void n("解析导入的json出错")}(e=>{const t=new EventTarget,o="uploadTask",s="uploadCompleted";let a=0;const d=[],l=()=>{for(;a<2&&d.length>0;){const e=d.shift(),[o,l,r]=e;a++,i({md5:o,size:l,fileName:r}).then((e=>{const o=d.length+a-1;n(`导入 ${r} 成功, 剩余任务数: ${o}`),t.dispatchEvent(new Event(s))})).catch((o=>{n(`错误: 导入 ${r} 失败, 详情见控制台`),console.warn(`[${r}] Upload failed:`,o,e),t.dispatchEvent(new Event(s))}))}0===d.length&&0===a&&n("导入任务完成, 请刷新网页查看")};t.addEventListener(o,(e=>{d.push(e.detail),l()})),t.addEventListener(s,(()=>{a--,l()}));for(const n of e)t.dispatchEvent(new CustomEvent(o,{detail:n}))})(a),e.style.display="none"}catch(e){n("解析 JSON 文件时发生错误:")}},d.onerror=()=>{n("读取文件时发生错误。")},d.readAsText(a)}))}))};window.addEventListener("DOMContentLoaded",(function(){t(),o(),d()}))}();
