!function(){"use strict";let e;const t=()=>{e=document.createElement("div"),e.classList.add("toast-container"),document.body.appendChild(e),e.addEventListener("toastMsg",(function(e){n(e.detail.message)}))},n=(n,o)=>{"object"==typeof n&&(n=JSON.stringify(n,null,2)),e||t();const s=document.createElement("div");s.classList.add("toast","hide"),s.textContent=n,e.append(s),s.classList.toggle("hide"),s.classList.toggle("slideInDown"),setTimeout((()=>{s.classList.toggle("hide"),s.classList.toggle("slideInDown"),setTimeout((()=>{s.remove()}),350)}),3e3)};const o=()=>{document.addEventListener("collect-files",(()=>{const e=(()=>{const e=document.querySelector(".ant-spin-container > .hombody");if(!e)return[];const t=Object.values(e)[0];return(e=>{let t=[];for(let n=0;n<e.length;n++){const o=e[n];if(o?.Etag&&o?.checked){const{FileId:e,FileName:n,Etag:s,Type:a,Size:d,S3KeyFlag:i}=o;t.push({FileId:e,FileName:n,Etag:s,Type:a,Size:d,S3KeyFlag:i})}}return t})(t?.child?.pendingProps?.props?.children?.props?.dataSource||t?.child?.pendingProps?.props?.children?.props?.loadedFileList||[])})().map((e=>[e.Etag,e.Size,e.FileName]));e.length>80&&n("提示, 导出文件多于80个"),0!==e.length?function(e,t="data.json"){const n=JSON.stringify(e,null,2),o=new Blob([n],{type:"application/json"}),s=URL.createObjectURL(o),a=document.createElement("a");a.href=s,a.download=t,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s)}(e):n("未勾选任何文件")}))},s={platform:"android","app-version":"75","content-type":"application/json",Accept:"*/*",Connection:"keep-alive"},a=()=>{const{search:e}=location;return""===e||"?"===e?0:e.startsWith("?homeFilePath=")?"?homeFilePath="===e?0:e.includes(",")?e.split(",").at(-1):e.split("=").at(-1):0},d=async({md5:e,size:t,fileName:n})=>{const o={method:"POST",headers:{...s,authorization:`Bearer ${localStorage.getItem("authorToken")}`},body:JSON.stringify({driveId:0,duplicate:1,NotReuse:!0,etag:e.toLowerCase(),fileName:n,parentFileId:Number(a()),size:t,type:0})},d=await(await fetch("https://www.123pan.com/api/file/upload_request",o)).json(),{Reuse:i,UploadId:r}=d.data;return{Reuse:i,UploadId:r}},i=e=>{try{const o=JSON.parse(e);if(!(t=o,!!Array.isArray(t)&&0!==t.length&&!!Array.isArray(t[0])&&"number"==typeof t[0][1]))return void n("非本插件导出的格式, 不受支持, 无法导入");(e=>{const t=new EventTarget,o="uploadTask",s="uploadCompleted";let a=0;const i=[],r=()=>{for(;a<2&&i.length>0;){const e=i.shift(),[o,r,l]=e;a++,d({md5:o,size:r,fileName:l}).then((e=>{if(e.Reuse){const e=i.length+a-1;n(`导入 ${l} 成功, 剩余任务数: ${e}`),t.dispatchEvent(new Event(s))}else n(`无法秒传 ${l}`),t.dispatchEvent(new Event(s))})).catch((o=>{n(`错误: 导入 ${l} 请求失败`),console.warn(`[${l}] Upload failed:`,o,e),t.dispatchEvent(new Event(s))}))}0===i.length&&0===a&&n("导入任务完成, 请刷新网页查看")};t.addEventListener(o,(e=>{i.push(e.detail),r()})),t.addEventListener(s,(()=>{a--,r()}));for(const n of e)t.dispatchEvent(new CustomEvent(o,{detail:n}))})(o)}catch(e){n("解析 JSON 文件时发生错误")}var t};let r;const l=()=>{if(r)return r;r=document.createElement("div"),r.id="json-drop-overlay";const e=document.createElement("div");e.classList.add("drop-box-visual"),e.innerHTML="将 JSON 文件拖放到此窗口任意位置<br/>或者点击任意区域手动选择文件";const t=document.createElement("button");return t.classList.add("close-button"),t.classList.add("cross"),r.appendChild(t),r.appendChild(e),document.body.appendChild(r),r},c=e=>{if(!e)return void n("未选择/拖放任何文件");if("application/json"!==e.type&&!e.name.toLowerCase().endsWith(".json"))return void n("读取到文件不是 JSON 文件  请拖放 .json 文件");const t=new FileReader;t.readAsText(e),t.onload=e=>{const t=e.target.result;i(t)},t.onerror=()=>{n("读取文件时发生错误")}},p=()=>{const e=document.createElement("button");e.id="importJson",e.textContent="导入到当前文件夹",document.body.appendChild(e);const t=l();(e=>{const t=e.querySelector("button.cross");t.addEventListener("click",(function(){e.style.display="none"})),e.addEventListener("click",(function(n){if(n.target===t)return;const s=document.createElement("input");s.type="file",s.style.display="none",document.body.appendChild(s),s.addEventListener("change",(()=>{const t=s.files[0];c(t),e.style.display="none",o.style.borderColor="rgb(200 200 200)"})),s.click(),s.remove()}));const o=e.querySelector("div.drop-box-visual");e.addEventListener("dragover",(e=>{e.preventDefault(),e.stopPropagation(),document.querySelector("#maskAll").style.display="none",o.style.borderColor="rgb(179 126 73 / 79%)"})),e.addEventListener("dragleave",(e=>{e.stopPropagation(),o.style.borderColor="rgb(200 200 200)",document.querySelector("#maskAll").style.display="none"})),e.addEventListener("drop",(t=>{t.preventDefault(),t.stopPropagation(),document.querySelector("#maskAll").style.display="none",o.style.borderColor="rgb(179 126 73 / 79%)";const s=t.dataTransfer.files;if(0===s.length)return void n("没有拖放任何文件");const a=s[0];c(a),e.style.display="none",o.style.borderColor="rgb(200 200 200)"}))})(t),e.addEventListener("click",(function(){t.style.display="flex"}))};window.addEventListener("DOMContentLoaded",(function(){t(),o(),p()}))}();
